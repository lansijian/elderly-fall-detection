# 跌倒预测实时仪表盘

这是一个基于Flask和Socket.IO的实时跌倒预测可视化系统，可以直观地展示传感器数据和跌倒预测结果，支持多种预训练深度学习模型。

## 功能特点

- **多模型支持**：可选择多种预训练模型（LSTM、GRU、CNN-LSTM、CNN-GRU、TCN等）
- **实时数据可视化**：同时显示9个传感器（加速度计、陀螺仪、欧拉角）的实时数据曲线
- **跌倒风险预测**：实时显示跌倒风险预测结果和置信度
- **交互式控制**：支持开始/暂停/继续/停止等操作
- **可调速度**：支持0.5x-4x多种播放速度，便于观察分析
- **详细数据信息**：显示时间戳、标签、参与者ID等详细信息

## 技术架构

- **后端**：
  - Flask：Web应用框架
  - Flask-SocketIO：实现实时双向通信
  - PyTorch：加载和运行深度学习模型
  - Pandas：数据处理和管理
  - Eventlet：异步I/O框架，提高并发性能

- **前端**：
  - Socket.IO：实时数据传输
  - Chart.js：绘制实时数据图表
  - HTML5/CSS3：响应式用户界面
  - JavaScript：前端交互逻辑

## 文件结构

- **`app.py`**：主应用程序，包含Flask路由和Socket.IO事件处理
- **`models.py`**：模型定义文件，包含所有支持的深度学习模型架构
- **`requirements.txt`**：项目依赖列表
- **`templates/`**：
  - `index.html`：主页面模板，包含用户界面和前端逻辑
- **`static/`**：
  - `styles.css`：样式表文件
- **`*.pth`**：各种预训练模型权重文件
- **`test_data.csv`**：用于模拟的测试数据集

## 安装与运行

### 前提条件

- Python 3.8+
- pip（Python包管理器）

### 安装步骤

1. 克隆或下载项目到本地
2. 安装依赖包：

```bash
pip install -r requirements.txt
```

### 运行应用

```bash
python app.py
```

应用将在 http://127.0.0.1:5000 启动，可以通过浏览器访问。

## 使用指南

1. **选择模型**：从下拉菜单中选择要使用的预训练模型
2. **调整速度**：使用滑块调整数据模拟速度（0.5x-4x）
3. **开始模拟**：点击"开始模拟"按钮
4. **控制模拟**：
   - 点击"暂停模拟"可以暂停数据流
   - 点击"继续模拟"可以恢复数据流
   - 点击"停止模拟"可以完全停止当前模拟
5. **观察结果**：
   - 右侧9个图表显示传感器实时数据
   - 左侧状态面板显示预测结果和置信度
   - 详细信息面板显示当前数据点的详细信息

## 支持的模型

实时仪表盘支持以下预训练模型（按训练复杂度排序）：

1. **Original LSTM** (best_model.pth): 原始LSTM模型，使用未平衡的时间序列数据训练。

2. **Balanced LSTM** (best_model_balanced.pth): 使用平衡数据集(1:2)训练的LSTM模型。

3. **Regularized LSTM** (best_model_lstm_regularized.pth): 添加批标准化、Dropout和L2正则化的LSTM模型。

4. **GRU** (best_model_gru.pth): 使用门控循环单元(GRU)代替LSTM的模型，训练更快且参数更少。

5. **Bidirectional GRU** (best_model_bidirectional_gru.pth): 双向GRU模型，可以捕获时间序列的双向依赖关系。

6. **CNN-LSTM** (best_model_cnn_lstm.pth): 结合1D卷积网络和LSTM的混合模型，先提取局部特征再捕获长期依赖。

7. **CNN-GRU** (best_model_cnn_gru.pth): 结合1D卷积网络和GRU的混合模型，性能与CNN-LSTM相当但训练更快。

8. **TCN** (best_model_tcn.pth): 时间卷积网络模型，通过扩张卷积有效捕获长距离时间依赖。

9. **Unbalanced GRU** (best_model_gru_unbalanced.pth): 使用原始未采样数据训练的GRU模型，预测时间与实际跌倒时刻更接近，但整体检测性能略低。

10. **Unbalanced CNN-LSTM** (best_model_cnn_lstm_unbalanced.pth): 使用原始未采样数据训练的CNN-LSTM模型，保持与采样模型相同的架构，但不使用1:2采样策略。

### 采样与未采样模型

- **采样模型**（如常规GRU, CNN-LSTM）使用了1:2的跌倒与非跌倒样本比例，这使得模型对跌倒前兆更敏感，能够提前约2秒预测跌倒风险，适合需要早期预警的场景。

- **未采样模型**（Unbalanced GRU, Unbalanced CNN-LSTM）使用原始数据分布（约1:9的跌倒与非跌倒比例），预测时间更接近实际跌倒发生时刻，适合对预测时间点准确性要求较高的场景。

## 预测逻辑

系统使用滑动窗口方法进行实时预测：

1. 收集传感器数据，填充数据窗口（默认窗口大小为100帧）
2. 当窗口填满后，通过预训练模型进行预测
3. 根据预测结果和置信度，显示"正常活动"或"有跌倒风险"
4. 窗口滑动，继续收集新数据并预测

为了提高预测稳定性，系统还实现了：

- **稳定期**：窗口填满后，等待额外的几帧才开始预测，避免初始不稳定
- **状态跟踪**：跟踪预测状态变化，确保UI响应及时更新
- **自适应稳定期**：不同模型使用不同长度的稳定期，适应各自特性

## 性能优化

系统进行了多项性能优化：

- **批量图表更新**：减少重绘次数，提高UI响应性
- **使用requestAnimationFrame**：确保图表更新在浏览器渲染循环中平滑执行
- **禁用不必要的动画**：提高图表渲染性能
- **异步数据处理**：使用eventlet确保数据处理不阻塞主线程

## 注意事项

- 系统默认使用CPU进行模型推理，如需使用GPU，请修改`app.py`中的设备配置
- 数据模拟速度受硬件性能影响，在低性能设备上可能需要降低速度
- 为获得最佳体验，推荐使用现代浏览器（Chrome、Firefox、Edge等）

## 故障排除

- **页面显示"正在初始化..."但不更新**：检查控制台是否有WebSocket连接错误
- **图表卡顿**：尝试降低模拟速度或减少同时显示的图表数量
- **模型加载失败**：确保所有.pth文件都在正确位置，且与models.py中定义的架构匹配
- **数据不显示**：检查test_data.csv文件是否存在且格式正确

## 扩展与定制

- **添加新模型**：在models.py中定义新模型架构，并将训练好的权重文件放在应用目录中
- **修改UI**：编辑templates/index.html和static/styles.css文件
- **调整窗口大小**：修改models.py中的WINDOW_SIZE常量
- **使用实时数据**：修改app.py，将数据源从CSV文件改为实时传感器输入

## 许可证

本项目仅供学术和教育目的使用。 